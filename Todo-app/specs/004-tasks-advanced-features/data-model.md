# Data Model: Extended Task System

## Task Entity

### Fields
- **id** (int, primary key, auto-increment)
  - Unique identifier for each task
  - Auto-generated by the database

- **title** (str, required)
  - Title of the task
  - Maximum length: 255 characters
  - Cannot be null

- **description** (str, optional)
  - Detailed description of the task
  - Maximum length: 1000 characters
  - Can be null

- **is_completed** (bool)
  - Status of the task completion
  - Default value: false
  - Represents whether the task has been completed

- **priority** (str)
  - Priority level of the task
  - Allowed values: "low", "medium", "high"
  - Default value: "medium"
  - Used for sorting and filtering tasks

- **tags** (JSONB or List[str])
  - Array of tags associated with the task
  - Default value: empty array []
  - Used for categorizing and filtering tasks
  - Stored as JSONB in PostgreSQL for efficient querying

- **due_date** (datetime, optional)
  - Deadline or target completion date for the task
  - Default value: null
  - Can be null for tasks without deadlines
  - Stored as timestamp with timezone in PostgreSQL

- **user_id** (str)
  - Foreign key referencing the user who owns the task
  - Comes from Better Auth user system
  - Ensures user-scoped access control

- **created_at** (datetime)
  - Timestamp when the task was created
  - Default value: current timestamp
  - Automatically set on creation

- **updated_at** (datetime)
  - Timestamp when the task was last updated
  - Default value: current timestamp
  - Automatically updated on modification

### Relationships
- **User** (many-to-one)
  - Each task belongs to one user
  - Foreign key: user_id â†’ users.id (from Better Auth)

### Validation Rules
1. **Title**:
   - Required field
   - Maximum 255 characters
   - Cannot be empty string

2. **Description**:
   - Optional field
   - Maximum 1000 characters if provided

3. **Priority**:
   - Required field
   - Must be one of: "low", "medium", "high"
   - Case-sensitive validation

4. **Tags**:
   - Optional field
   - Maximum 10 tags per task
   - Each tag maximum 50 characters
   - Tags should contain only alphanumeric characters and hyphens/underscores

5. **Due Date**:
   - Optional field
   - If provided, must be a valid datetime
   - Can be in the past, present, or future

### State Transitions
- **is_completed** can transition from false to true (task completed)
- **is_completed** can transition from true to false (task uncompleted)
- All other fields can be modified by the task owner

## Database Schema (PostgreSQL)

```sql
-- Tasks table
CREATE TABLE tasks (
    id SERIAL PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    is_completed BOOLEAN NOT NULL DEFAULT FALSE,
    priority VARCHAR(20) NOT NULL DEFAULT 'medium',
    tags JSONB NOT NULL DEFAULT '[]',
    due_date TIMESTAMP WITH TIME ZONE,
    user_id VARCHAR(255) NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE
);

-- Indexes for performance
CREATE INDEX idx_tasks_user_id ON tasks(user_id);
CREATE INDEX idx_tasks_priority ON tasks(priority);
CREATE INDEX idx_tasks_is_completed ON tasks(is_completed);
CREATE INDEX idx_tasks_due_date ON tasks(due_date);
CREATE INDEX idx_tasks_created_at ON tasks(created_at);
-- GIN index for JSONB tags field for efficient array operations
CREATE INDEX idx_tasks_tags ON tasks USING GIN (tags);
```

## API Representation

### Task Object
```json
{
  "id": 1,
  "title": "Sample task",
  "description": "Task description",
  "is_completed": false,
  "priority": "medium",
  "tags": ["work", "important"],
  "due_date": "2025-12-31T23:59:59Z",
  "user_id": "user-uuid-string",
  "created_at": "2025-12-28T10:00:00Z",
  "updated_at": "2025-12-28T10:00:00Z"
}
```

### Validation Schema
```json
{
  "type": "object",
  "properties": {
    "title": {
      "type": "string",
      "minLength": 1,
      "maxLength": 255
    },
    "description": {
      "type": ["string", "null"],
      "maxLength": 1000
    },
    "is_completed": {
      "type": "boolean"
    },
    "priority": {
      "type": "string",
      "enum": ["low", "medium", "high"]
    },
    "tags": {
      "type": "array",
      "items": {
        "type": "string",
        "pattern": "^[a-zA-Z0-9_-]{1,50}$"
      },
      "maxItems": 10
    },
    "due_date": {
      "type": ["string", "null"],
      "format": "date-time"
    }
  },
  "required": ["title", "priority"]
}
```